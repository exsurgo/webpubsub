<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>WebPubSub by exsurgo</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>WebPubSub</h1>
        <h2>A .NET PubSub Server for Real-Time Web Applications</h2>
        <a href="https://github.com/exsurgo/webpubsub" class="button"><small>View project on</small>GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <p>WebPubSub is a websocket-based PubSub server that can be integrated with an ASP.NET application.  The library allows you to easily convert a traditional web application into a live-collaboration platform.  Some of the possibilities include instant messaging, chat, live alerts, real-time feeds and concurrency management.</p>

<ul>
<li><strong>Real-Time Communication in ASP.NET Apps</strong></li>
<li><strong>JavaScript Client Included</strong></li>
<li><strong>Easy to Use PubSub Pattern</strong></li>
<li><strong>Integration with Forms Authentication</strong></li>
<li><strong>Flash Socket Policy Server</strong></li>
</ul><h3>Chat Sample</h3>

<p>The most common sample usage of real-time apps is the chat example. The following chat sample illustrates how four separate users with four separate browsers can connect in real-time.  The browsers below are Chrome, FireFox, Safari and IE8 (using Flash fallback).
<img src="http://github.com/exsurgo/webpubsub/blob/master/Samples/Images/Chat.jpg?raw=true" alt="WebPubSub Chat"></p>

<h3>Concurrency Sample</h3>

<p>Another compelling usage is concurrency management. In the following example, if multiple users are editing the same record, all users are aware of it.  If a user focuses on a field, the field is locked for the rest of the users.  When the fields is blurred, then value is synced in all other forms. 
<img src="http://github.com/exsurgo/webpubsub/blob/master/Samples/Images/Concurrency.jpg?raw=true" alt="WebPubSub Chat"></p>

<h3>JavaScript Client</h3>

<p>The following code demonstrates the usage from the JavaScript client. </p>

<div class="highlight">
<pre><span class="c1">//Open connection</span>
<span class="nx">PubSub</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

    <span class="c1">//Create a channel, Can be any string</span>
    <span class="kd">var</span> <span class="nx">channel</span> <span class="o">=</span> <span class="s2">"my-channel"</span><span class="p">;</span>

    <span class="c1">//Subscribe to the channel</span>
    <span class="c1">//"this" keyword refers to PubSub object</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">channel</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>

    <span class="p">});</span>

    <span class="c1">//Unsubscribe to the channel</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">unsubscribe</span><span class="p">(</span><span class="nx">channel</span><span class="p">);</span>

    <span class="c1">//Query other users subscribed to the channel</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">channel</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">otherUsers</span><span class="p">)</span> <span class="p">{</span>

    <span class="p">});</span>

    <span class="c1">//Another user has connected to the channel</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">channel</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">alert</span><span class="p">(</span><span class="s2">"User has id "</span> <span class="o">+</span> <span class="nx">user</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s2">" and name "</span> <span class="o">+</span> <span class="nx">user</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="c1">//Another user has disconnected from the channel</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">disconnect</span><span class="p">(</span><span class="nx">channel</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">user</span><span class="p">)</span> <span class="p">{</span>

    <span class="p">});</span>

    <span class="c1">//Publish a message to the channel</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">publish</span><span class="p">(</span><span class="nx">channel</span><span class="p">,</span> <span class="s2">"Hello World"</span><span class="p">);</span>

    <span class="c1">//Can publish strings or objects</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">publish</span><span class="p">(</span><span class="nx">channel</span><span class="p">,</span> <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">123</span><span class="p">,</span> <span class="nx">value</span><span class="o">:</span> <span class="s2">"Another Message"</span> <span class="p">});</span>

<span class="p">});</span>
</pre>
</div>


<h3>Server-Side Installation</h3>

<p>For installing WebPubSub on the server, you just need to include the dependencies, add the config settings and call the start and stop methods in the Global.asax file.</p>

<p><em>Web.config</em></p>

<div class="highlight">
<pre>    <span class="nt">&lt;appSettings&gt;</span>
        <span class="c">&lt;!--WebPubSub Settings--&gt;</span>
        <span class="nt">&lt;add</span> <span class="na">key=</span><span class="s">"PubSubPort"</span> <span class="na">value=</span><span class="s">"8765"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;add</span> <span class="na">key=</span><span class="s">"PubSubEnableSecurity"</span> <span class="na">value=</span><span class="s">"false"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;add</span> <span class="na">key=</span><span class="s">"PubSubCertPath"</span> <span class="na">value=</span><span class="s">"~/localhost.pfx"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;add</span> <span class="na">key=</span><span class="s">"PubSubCertPassword"</span> <span class="na">value=</span><span class="s">"localhost"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;add</span> <span class="na">key=</span><span class="s">"PubSubEnableFlashPolicyServer"</span> <span class="na">value=</span><span class="s">"true"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/appSettings&gt;</span>
</pre>
</div>


<p><em>Global.asax</em></p>

<div class="highlight">
<pre>        <span class="k">protected</span> <span class="k">void</span> <span class="nf">Application_Start</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="c1">//Start WebPubSub server</span>
            <span class="n">PubSub</span><span class="p">.</span><span class="n">StartServer</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">protected</span> <span class="k">void</span> <span class="nf">Application_End</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="c1">//Stop WebPubSub server</span>
            <span class="n">PubSub</span><span class="p">.</span><span class="n">StopServer</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre>
</div>


<h3>Server-Side Calls</h3>

<p>You can also interact with the system server-side code.  The following message is sent from the server using C# and is received by the JavaScript client.</p>

<div class="highlight">
<pre><span class="k">public</span> <span class="k">void</span> <span class="nf">SendMessage</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">//Publish message to channel</span>
    <span class="n">PubSub</span><span class="p">.</span><span class="n">Publish</span><span class="p">(</span><span class="s">"my-channel"</span><span class="p">,</span> <span class="k">new</span> <span class="p">{</span> <span class="n">id</span> <span class="p">=</span> <span class="m">123</span><span class="p">,</span> <span class="k">value</span> <span class="p">=</span> <span class="s">"Some Text"</span> <span class="p">});</span>
<span class="p">}</span>
</pre>
</div>


<h3>Authentication</h3>

<p>By default, WebPubSub integrates with ASP.NET forms authentication. When a user is logged in, the <em>User.Identity.Name</em> value is the unique ID of the user. <em>FormsAuthenticationTicket.UserData</em> is the user's friendly name.</p>

<div class="highlight">
<pre><span class="c1">//Create authentication cookie </span>
<span class="n">HttpCookie</span> <span class="n">authCookie</span> <span class="p">=</span> <span class="n">FormsAuthentication</span><span class="p">.</span><span class="n">GetAuthCookie</span><span class="p">(</span><span class="n">userIdentity</span><span class="p">,</span> <span class="k">false</span><span class="p">);</span>
<span class="c1">//Important: Needed for flash websocket fallback</span>
<span class="n">authCookie</span><span class="p">.</span><span class="n">HttpOnly</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
<span class="c1">//Create authentication ticket</span>
<span class="n">FormsAuthenticationTicket</span> <span class="n">ticket</span> <span class="p">=</span> <span class="n">FormsAuthentication</span><span class="p">.</span><span class="n">Decrypt</span><span class="p">(</span><span class="n">authCookie</span><span class="p">.</span><span class="n">Value</span><span class="p">);</span>
<span class="c1">//Store name in user data</span>
<span class="n">FormsAuthenticationTicket</span> <span class="n">newTicket</span> <span class="p">=</span> <span class="k">new</span> <span class="n">FormsAuthenticationTicket</span><span class="p">(</span>
    <span class="n">ticket</span><span class="p">.</span><span class="n">Version</span><span class="p">,</span> 
    <span class="n">ticket</span><span class="p">.</span><span class="n">Name</span><span class="p">,</span> 
    <span class="n">ticket</span><span class="p">.</span><span class="n">IssueDate</span><span class="p">,</span> 
    <span class="n">ticket</span><span class="p">.</span><span class="n">Expiration</span><span class="p">,</span> 
    <span class="n">ticket</span><span class="p">.</span><span class="n">IsPersistent</span><span class="p">,</span> 
    <span class="n">userName</span><span class="p">);</span>
<span class="c1">//Encrypt and add to response</span>
<span class="n">authCookie</span><span class="p">.</span><span class="n">Value</span> <span class="p">=</span> <span class="n">FormsAuthentication</span><span class="p">.</span><span class="n">Encrypt</span><span class="p">(</span><span class="n">newTicket</span><span class="p">);</span>
<span class="n">Response</span><span class="p">.</span><span class="n">Cookies</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">authCookie</span><span class="p">);</span>
</pre>
</div>


<h3>Support for Older Browsers</h3>

<p>Though most modern browsers support websockets natively, older browsers such as IE do not.  However, you can support these browsers by using Flash as a fallback mechanism.   An excellent shim that uses Flash is the <a href="https://github.com/gimite/web-socket-js">web-socket-js</a>, which is included in the sample.  WebPubSub also includes a Flash socket policy server, which is a security requirement for Flash clients to use websockets.
You also need support for the JSON.stringify() and JSON.parse() methods.  The sample uses the <a href="http://bestiejs.github.com/json3/">JSON3</a> shim.</p>

<h3>Dependencies</h3>

<p>The library uses the excellent <a href="http://superwebsocket.codeplex.com/">SuperWebSocket</a> library, a .NET websocket server. </p>

<hr><p>Created and maintained by <a href="http://linkedin.com/in/sterlingnichols">Sterling Nichols</a>.</p>
        </section>

        <aside id="sidebar">
          <a href="https://github.com/exsurgo/webpubsub/zipball/master" class="button">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/exsurgo/webpubsub/tarball/master" class="button">
            <small>Download</small>
            .tar.gz file
          </a>

          <p class="repo-owner"><a href="https://github.com/exsurgo/webpubsub"></a> is maintained by <a href="https://github.com/exsurgo">exsurgo</a>.</p>

          <p>This page was generated by <a href="pages.github.com">GitHub Pages</a> using the Architect theme by <a href="http://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

  
  </body>
</html>